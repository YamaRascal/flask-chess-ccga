<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .chess-square {
            width: 64px;
            height: 64px;
        }
        .chess-piece {
            font-size: 40px;
            line-height: 1;
            user-select: none;
            cursor: pointer;
        }
        .selected {
            box-shadow: inset 0 0 0 3px #3b82f6;
        }
        .valid-move {
            box-shadow: inset 0 0 0 2px #10b981;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl font-bold text-center mb-8 text-gray-800">Chess Game</h1>
            
            <div class="flex flex-col lg:flex-row gap-8 items-start justify-center">
                <!-- Chess Board -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="grid grid-cols-8 gap-0 border-4 border-gray-800" id="chessboard">
                        <!-- Board squares will be generated by JavaScript -->
                    </div>
                </div>
                
                <!-- Game Info -->
                <div class="bg-white rounded-lg shadow-lg p-6 min-w-64">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800">Game Info</h2>
                    
                    <div class="mb-4">
                        <p class="text-lg">Current Player:</p>
                        <p id="current-player" class="text-xl font-bold text-blue-600">White</p>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-lg">Game Status:</p>
                        <p id="game-status" class="text-xl font-bold text-green-600">In Progress</p>
                    </div>
                    
                    <div id="winner-info" class="mb-4 hidden">
                        <p class="text-lg">Winner:</p>
                        <p id="winner" class="text-xl font-bold text-yellow-600"></p>
                    </div>
                    
                    <button id="reset-btn" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                        Reset Game
                    </button>
                    
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold mb-2">How to Play:</h3>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>• Click a piece to select it</li>
                            <li>• Click a valid square to move</li>
                            <li>• Capture the opponent's king to win</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class ChessUI {
            constructor() {
                this.selectedSquare = null;
                this.validMoves = [];
                this.board = null;
                this.currentPlayer = 'white';
                this.gameOver = false;
                
                this.pieceSymbols = {
                    'white': {
                        'king': '♔', 'queen': '♕', 'rook': '♖', 'bishop': '♗', 'knight': '♘', 'pawn': '♙'
                    },
                    'black': {
                        'king': '♚', 'queen': '♛', 'rook': '♜', 'bishop': '♝', 'knight': '♞', 'pawn': '♟'
                    }
                };
                
                this.init();
            }
            
            async init() {
                this.createBoard();
                await this.loadBoard();
                this.setupEventListeners();
            }
            
            createBoard() {
                const chessboard = document.getElementById('chessboard');
                chessboard.innerHTML = '';
                
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const square = document.createElement('div');
                        square.className = `chess-square flex items-center justify-center ${
                            (row + col) % 2 === 0 ? 'bg-amber-100' : 'bg-amber-800'
                        }`;
                        square.dataset.row = row;
                        square.dataset.col = col;
                        square.addEventListener('click', (e) => this.handleSquareClick(e));
                        chessboard.appendChild(square);
                    }
                }
            }
            
            async loadBoard() {
                try {
                    const response = await fetch('/api/board');
                    const data = await response.json();
                    this.board = data.board;
                    this.currentPlayer = data.current_player;
                    this.gameOver = data.game_over;
                    this.renderBoard();
                    this.updateGameInfo(data);
                } catch (error) {
                    console.error('Error loading board:', error);
                }
            }
            
            renderBoard() {
                const squares = document.querySelectorAll('.chess-square');
                
                squares.forEach((square, index) => {
                    const row = Math.floor(index / 8);
                    const col = index % 8;
                    const piece = this.board[row][col];
                    
                    square.innerHTML = '';
                    square.className = `chess-square flex items-center justify-center ${
                        (row + col) % 2 === 0 ? 'bg-amber-100' : 'bg-amber-800'
                    }`;
                    
                    if (piece) {
                        const pieceElement = document.createElement('div');
                        pieceElement.className = 'chess-piece';
                        pieceElement.textContent = this.pieceSymbols[piece.color][piece.type];
                        square.appendChild(pieceElement);
                    }
                    
                    if (this.selectedSquare && this.selectedSquare[0] === row && this.selectedSquare[1] === col) {
                        square.classList.add('selected');
                    }
                });
            }
            
            async handleSquareClick(event) {
                if (this.gameOver) return;
                
                const square = event.currentTarget;
                const row = parseInt(square.dataset.row);
                const col = parseInt(square.dataset.col);
                const piece = this.board[row][col];
                
                if (this.selectedSquare) {
                    if (this.selectedSquare[0] === row && this.selectedSquare[1] === col) {
                        this.clearSelection();
                        return;
                    }
                    
                    await this.makeMove(this.selectedSquare, [row, col]);
                    this.clearSelection();
                } else if (piece && piece.color === this.currentPlayer) {
                    this.selectedSquare = [row, col];
                    this.renderBoard();
                }
            }
            
            async makeMove(from, to) {
                try {
                    const response = await fetch('/api/move', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ from, to })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.board = result.board;
                        this.currentPlayer = result.current_player;
                        this.gameOver = result.game_over;
                        this.renderBoard();
                        this.updateGameInfo(result);
                    } else {
                        alert(result.error || 'Invalid move');
                    }
                } catch (error) {
                    console.error('Error making move:', error);
                }
            }
            
            clearSelection() {
                this.selectedSquare = null;
                this.validMoves = [];
                this.renderBoard();
            }
            
            updateGameInfo(data) {
                document.getElementById('current-player').textContent = 
                    data.current_player.charAt(0).toUpperCase() + data.current_player.slice(1);
                
                if (data.game_over) {
                    document.getElementById('game-status').textContent = 'Game Over';
                    document.getElementById('game-status').className = 'text-xl font-bold text-red-600';
                    document.getElementById('winner-info').classList.remove('hidden');
                    document.getElementById('winner').textContent = 
                        data.winner.charAt(0).toUpperCase() + data.winner.slice(1);
                } else {
                    document.getElementById('game-status').textContent = 'In Progress';
                    document.getElementById('game-status').className = 'text-xl font-bold text-green-600';
                    document.getElementById('winner-info').classList.add('hidden');
                }
            }
            
            setupEventListeners() {
                document.getElementById('reset-btn').addEventListener('click', async () => {
                    try {
                        await fetch('/api/reset', { method: 'POST' });
                        await this.loadBoard();
                        this.clearSelection();
                    } catch (error) {
                        console.error('Error resetting game:', error);
                    }
                });
            }
        }
        
        // Initialize the chess game when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ChessUI();
        });
    </script>
</body>
</html>